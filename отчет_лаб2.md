Наш плохой Dockerfile:

```dockerfile
FROM ubuntu:latest

RUN apt-get install -y nginx curl && \
    rm -rf /var/lib/apt/lists/*

COPY index.html /var/www/html/

RUN echo "<h1>плохой Dockerfile</h1>" > /var/www/html/index.html
RUN chown -R new-user:new-user /var/www/html

EXPOSE 80
CMD ["nginx", "-g", "daemon off;"]
```

Начнем построчно разбирать, что происходит, подмечая и исправляя ошибки:

`FROM ubuntu:latest`

Здесь мы скачиваем образ ubuntu, используя тег latest - это 
нарушеат воспроизводимость контейнера, так как при обновлении версии ubuntu
(например на Dockerhub) наш контейнер поменяется. Значит, нужно использовать 
конкретную версию

`FROM ubuntu:latest` -> `FROM ubuntu:22.04`

Идем далее:

`RUN apt-get install -y nginx curl && \
    rm -rf /var/lib/apt/lists/*`

Здесь мы скачиваем пакеты nginx, dotnet и затем чистим кэш.
Мы не обновляем предварительно пакеты командой `apt-get upgrade -y`,
потенциально допуская уязвимость в устаревших версиях этих пакетов.

Затем:

`COPY index.html /var/www/html/`

Мы копируем файл index.html (подразумевается, что он существует у нас 
локально) в папку /var/www/html/ . И далее, 
следующим слоем: `RUN echo "<h1>плохой Dockerfile</h1>" > /var/www/html/index.html`
этот файл просто перезапишется, и получилось, что мы зря копировали,
просто добавили лишний слой и потеряли нужный файл. Нужно удалить COPY.

Далее: 

`RUN chown -R new-user:new-user /var/www/html`

Этим слоем, мы, казалось бы, меняем пользователя с root 
на new-user, но, так как мы все равно запускаем контейнер без USER,
он работает от root. Соотвественно, нам нужно добавить:
`USER www-data`

Так же, RUN слои сильно "раздувают" размер нашего Dockerfile,
и лучше их объединить в один (по возможности).

Тогда, с учетом всех исправлений, наш исправленный Dockerfile
будет выглядеть так:

```dockerfile
FROM ubuntu:22.04

RUN apt-get update && apt-get upgrade -y && \
    apt-get install -y nginx curl && \
    echo "<h1>нормальный Dockerfile</h1>" > /var/www/html/index.html && \
    chown -R www-data:www-data /var/www/html && \
    rm -rf /var/lib/apt/lists/*

USER www-data
EXPOSE 80
CMD ["nginx", "-g", "daemon off;"]
```

Перейдем к плохим практикам именно по РАБОТЕ с контейнерами:

1) Запуск контейнера без ограничения на ресурсы. 
К примеру:
`docker run myapp`. Такой запуск, если, например, у нас
много вычислений, вполне может занять 100 % Cpu и ram на нашем
хосте, что плохо.

    Чтобы такого избежать, нужно накладывать ограничения, например
таким способом: `docker run -m 512m --cpus=1.0 myapp`
    
    Здесь мы накладываем ограничение на использование памяти (512mb)
и использование процессора

2) Монтирование volumes с root правами

    Например: `docker run -v /host/data:/app/data myapp`
    
    Здесь bind mount хост-директорий в контейнер приводит к permission denied 
(из-за того что UID не совпадают) 
или рискам безопасности (так как host файлы видны в контейнере).

    Соответственно, корректная версия:

    `docker run -v /host/data:/app/data:delegated --user 1001:1001 myapp`